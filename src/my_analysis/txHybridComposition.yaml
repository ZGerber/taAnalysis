  # txhybid_config.yaml

input_file: ${ALL_HYBRID}  # Path to the input ROOT file containing the data.
tree_name: "taTree"  # Name of the ROOT TTree to be analyzed.
output_dir: "/home/zane/software/taAnalysis/results/data/south"  # Directory to save the output results.
library_file: "/home/zane/software/taAnalysis/src/library/txHybridComposition.py"  # Path to the my_analysis file.
detector_config: "/home/zane/software/taAnalysis/src/config/detectors/tax4_south_config.yaml"  # Path to the detector configuration file.
custom_analysis: ~  # Path to the custom user functions python file.

# Detector settings.  Do not change this section.
# It is loaded automatically from the detector_config file.
detector: null

# The following setting is required for FD/Hybrid only. [0-15]
profile_fit_index: 7

# New columns to define
new_columns:
  - name: "Xmax"  # Name of the new column.
    expression: "prfc.xm[profile_fit_index]"  # Expression to calculate the values of the new column.

  - name: "Xlow"
    expression: "prfc.dep[profile_fit_index][0]"

  - name: "Xhigh"
    expression: "prfc.dep[profile_fit_index][prfc.nbin[profile_fit_index]-1]"

  - name: "LogEnergy"
    expression: "18. + TMath::Log10(prfc.eng[profile_fit_index])"

  - name: "Zenith"
    expression: "TMath::RadToDeg()*hctim.mthe[profile_fit_index]"

  - name: "Psi"
    expression: "TMath::RadToDeg()*hctim.mpsi[profile_fit_index]"

  - name: "PulseArea"
    expression: "tlfptn.pulsa"

  - name: "TriggeredSDCount"
    expression: "tlfptn.nhits"

  - name: "GeometryFitStatus"
    expression: "hctim.failmode[profile_fit_index]"

  - name: "ProfileFitStatus"
    expression: "prfc.failmode[profile_fit_index]"

  - name: "GeometryFitQuality"
    expression: "hctim.mchi2[profile_fit_index] / (prfc.nbin[profile_fit_index] - 2)"

  - name: "ProfileFitQuality"
    expression: "prfc.chi2[profile_fit_index] / prfc.ndf[profile_fit_index]"

  - name: "HitSDsXXYY"
    expression: "tlfptn.xxyy"

  - name: "HitSDsCLF"
    expression: "tlfptn.xyzclf"

  - name: "Talex00HitSDsXXYY"
    expression: "talex00.xxyy"

  - name: "HybridCoreX_FD"
    expression: "hctim.mcore[profile_fit_index][0]"

  - name: "HybridCoreY_FD"
    expression: "hctim.mcore[profile_fit_index][1]"

# Event Selection Criteria
cuts:
  - "Xmax > Xlow"
  - "Xmax < Xhigh"
  - "LogEnergy >= 18.5"
  - "Zenith <= 65."
  - "Psi <= 145."
  - "ProfileFitStatus == 0"
  - "ProfileFitQuality <= 25"
  - "GeometryFitStatus == 0"
  - "GeometryFitQuality <= 15"
  - "CoreProximity <= 5"

# Histogram parameters
hist_params:
  - name: "hXmax"  # Name of the histogram.
    title: "X_{max}"  # Title of the histogram.
    style: "histogram"  # Style of the plot (histogram).
    column: "Xmax"  # Column to be plotted.
    bins: 20  # Number of bins in the histogram.
    min: 300  # Minimum value of the histogram.
    max: 1400  # Maximum value of the histogram.
    x_title: "X_{max} [g/cm^{2}]"  # X-axis title.
    y_title: "Events"  # Y-axis title.
    show_stats: True  # Display statistics box on the plot.
    options: ~  # Additional options for the histogram.

  - name: "hXlow"
    title: "X_{low}"
    style: "histogram"
    column: "Xlow"
    bins: 18
    min: 0
    max: 900
    x_title: "X_{low} [g/cm^{2}]"
    y_title: "Events"
    show_stats: True
    options: ~

  - name: "hXhigh"
    title: "X_{high}"
    style: "histogram"
    column: "Xhigh"
    bins: 24
    min: 300
    max: 1500
    x_title: "X_{high} [g/cm^{2}]"
    y_title: "Events"
    show_stats: True
    options: ~

  - name: "hLogEnergy"
    title: "Energy"
    style: "histogram"
    column: "LogEnergy"
    bins: 14
    min: 18.0
    max: 21.5
    x_title: "log(E/eV)"
    y_title: "Events"
    show_stats: True
    options: ~

  - name: "hZenith"
    title: "Zenith"
    style: "histogram"
    column: "Zenith"
    bins: 9
    min: 0
    max: 90
    x_title: "Zenith [deg]"
    y_title: "Events"
    show_stats: True
    options: ~

  - name: "hPsi"
    title: "Psi"
    style: "histogram"
    column: "Psi"
    bins: 18
    min: 0
    max: 180
    x_title: "Psi [deg]"
    y_title: "Events"
    show_stats: True
    options:  ~

  - name: "hCoreProximity"
    title: "Core Proximity"
    style: "histogram"
    column: "CoreProximity"
    bins: 50
    min: 0
    max: 25
    x_title: "Core Proximity [km]"
    y_title: "Events"
    show_stats: True
    options: ~

  - name: "pXmaxEnergy"  # Name of the profile plot.
    title: "#LTX_{max}#GT vs. Energy"  # Title of the profile plot.
    style: "profile_plot"  # Style of the plot (profile plot).
    x_column: "LogEnergy"  # X-axis column.
    y_column: "Xmax"  # Y-axis column.
    x_bins: 5  # Number of bins in the x-axis.
    y_bins: ~  # Number of bins in the y-axis.
    x_min: ~  # Minimum value of the x-axis.
    x_max: ~  # Maximum value of the x-axis.
    x_bin_edges:  # List of bin edges for the x-axis.
      - 18.5
      - 18.75
      - 19.0
      - 19.25
      - 19.8
      - 20.3
    y_min: 400  # Minimum value of the y-axis.
    y_max: 1200  # Maximum value of the y-axis.
    x_title: "log(E/eV)"  # X-axis title.
    y_title: "#LTX_{max}#GT [g/cm^{2}]"  # Y-axis title.
    show_stats: True  # Display statistics box on the plot.
    options: ""  # Additional options for the profile plot.

# Specify the new columns to be defined via the user-defined functions.
# The callable functions must be defined in the my_analysis file.
# If callable is set to null:
    # One param given: Not yet defined.
    # Two params given: The new column is defined by a slice: value1[value2].
    # Three or more params given: Not yet defined.
user_functions:
  - new_column: "PulseAreaMean"
    callable: "calculateMeanOfVectors"
    args:
      - value: "PulseArea"

  - new_column: "HotSDSignal"
    callable: "findMaxInRVec"
    args:
      - value: "PulseAreaMean"

  - new_column: "HotSDIndex"
    callable: "findMaxIndex"
    args:
      - value: "PulseAreaMean"

  - new_column: "FD_CLF_X"
    callable: ~
    args:
      - value: "fd_clf_x"

  - new_column: "FD_CLF_Y"
    callable: ~
    args:
      - value: "fd_clf_y"

  - new_column: "HotSD_CLF"
    callable: ~
    args:
      - value: "HitSDsCLF"
      - value: "HotSDIndex"

  - new_column: "HotSD_CLF_X"
    callable: ~
    args:
      - value: "HotSD_CLF"
      - value: "0"

  - new_column: "HotSD_CLF_Y"
    callable: ~
    args:
      - value: "HotSD_CLF"
      - value: "1"

  - new_column: "HybridCoreX"
    callable: ~
    args:
      - value: "HybridCoreX_FD + FD_CLF_X"

  - new_column: "HybridCoreY"
    callable: ~
    args:
      - value: "HybridCoreY_FD + FD_CLF_Y"

  - new_column: "HotSDxxyy"
    callable: ~
    args:
      - value: "HitSDsXXYY"
      - value: "HotSDIndex"

  - new_column: "CoreProximity"
    callable: "coreProximity"
    args:
      - value: "HybridCoreX"
      - value: "HybridCoreY"
      - value: "HotSD_CLF_X"
      - value: "HotSD_CLF_Y"
